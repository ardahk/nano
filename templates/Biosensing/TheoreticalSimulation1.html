<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Biosensing Theoretical Simulation</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
 body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:0}
 h1{text-align:center;color:teal;margin:30px 0}
 h2,h3{color:teal;margin:0 0 14px}
 .container{width:100%;padding:0 20px 40px}
 .section{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:40px}
 .table-container{width:60%;background:#f4f4f4;padding:20px;border-radius:4px}
 table{width:100%;border-collapse:collapse;margin-bottom:20px}
 th,td{border:1px solid #ccc;padding:6px 8px;font-size:14px;text-align:left}
 th{background:#e6e6e6}
 td:nth-child(2){text-align:center;width:120px}
 td:nth-child(3){text-align:center;width:50px}
 .image-container{width:35%;text-align:center;position:relative}
 .image-container img{max-width:100%;border:1px solid #ccc;border-radius:4px}
 .highlight{position:absolute;border:2px solid teal;background:rgba(12,237,196,.2);display:none;pointer-events:none}
 .run-simulation-btn{background:#20c997;color:#fff;border:none;padding:10px 26px;font-size:16px;border-radius:5px;cursor:pointer;margin-top:20px}
 .run-simulation-btn:hover{background:#1eaa8c}
 #results{max-width:700px;margin:50px auto;display:none}
 #results-table{width:100%;border-collapse:collapse}
 #results-table th,#results-table td{border:1px solid #ccc;padding:6px;text-align:center}
 #results-table th{background:#e6e6e6}
 nav{margin-top:30px;background:#f2f2f2;padding:10px 14px;border-radius:8px;text-align:center}
 nav a{margin-right:18px;color:#333;text-decoration:none;font-weight:bold}
 nav a:hover{text-decoration:underline}
    </style>
</head>
<body>
    <nav>
        <a href="/">Sheet 3 – CNT Capacitor</a>
        <a href="/sheet1">Sheet 1 – RC Calc</a>
        <a href="/vo_rf">Vo & Rf Explorer</a>
        <a href="/vx">Vx(t) Graph</a>
        <a href="/covid">Covid Detection</a>
        <a href="/biosensing">Theoretical Simulation</a>
        <a href="/bio_project">Project Management</a>
        <a href="/ebeam">E-Beam Simulator</a>
    </nav>
    <div class="container">
        <h1>Biosensing Theoretical Simulation</h1>

 <!-- ══ Nanostructure ══ -->
        <div class="section">
            <div class="table-container">
   <h2>Parameter Entry</h2><h3>Nanostructure Parameters</h3>
                <table>
                    <tr><th>Parameter</th><th>Value</th><th>Unit</th></tr>
    <tr><td>Radius of CNT (r)</td>   <td><input id="cnt_radius" class="parameter-input" data-highlight="highlight-radius" type="number" step="any" value="{{ defaults.cnt_radius }}"></td><td>m</td></tr>
    <tr><td>Height of CNT (h)</td>   <td><input id="cnt_height" class="parameter-input" data-highlight="highlight-height" type="number" step="any" value="{{ defaults.cnt_height }}"></td><td>m</td></tr>
    <tr><td>Width of Base (w)</td>   <td><input id="base_width" class="parameter-input" data-highlight="highlight-width" type="number" step="any" value="{{ defaults.base_width }}"></td><td>m</td></tr>
    <tr><td>Gap Between CNTs (d)</td><td><input id="cnt_gap" class="parameter-input" data-highlight="highlight-gap" type="number" step="any" value="{{ defaults.cnt_gap }}"></td><td>m</td></tr>
    <tr><td>Length of Base (L)</td>  <td><input id="base_length" class="parameter-input" data-highlight="highlight-length" type="number" step="any" value="{{ defaults.base_length }}"></td><td>m</td></tr>
    <tr><td>Thickness of Base (T)</td><td><input id="base_thickness" class="parameter-input" data-highlight="highlight-thick" type="number" step="any" value="{{ defaults.base_thickness }}"></td><td>m</td></tr>
                </table>
            </div>
            <div class="image-container">
   <img src="{{ url_for('static',filename='images/CNTimage.png') }}" alt="CNT sketch">
                <div id="highlight-radius" class="highlight" style="top: 17%; left: 11%; width: 6%; height: 6%;"></div>
                <div id="highlight-height" class="highlight" style="top: 23%; left: 20%; width: 5%; height: 45%;"></div>
                <div id="highlight-width" class="highlight" style="top: 75%; left: 40%; width: 23%; height: 10%; transform: rotate(10deg); transform-origin: center;"></div>
                <div id="highlight-gap" class="highlight" style="top: 63%; left: 46%; width: 5%; height: 5%; transform: rotate(10deg); transform-origin: center;"></div>
                <div id="highlight-length" class="highlight" style="top: 65%; left: 63%; width: 27%; height: 10%; transform: rotate(153deg); transform-origin: center;"></div>
                <div id="highlight-thick" class="highlight" style="top: 45%; left: 87%; width: 4%; height: 8%;"></div>
            </div>
        </div>

 <!-- ══ Materials stack ══ -->
        <div class="section">
            <div class="table-container">
                <h3>Materials Stack Parameters</h3>
                <table>
                    <tr><th>Parameter</th><th>Value</th><th>Unit</th></tr>
    <tr><td>Silicon Thickness</td>   <td><input id="t_si" class="parameter-input" data-highlight="highlight-Sithick" type="number" step="any" value="{{ defaults.t_si }}"></td><td>m</td></tr>
    <tr><td>SiO₂ Thickness</td>      <td><input id="t_sio2_1" class="parameter-input" data-highlight="highlight-SiO2thick" type="number" step="any" value="{{ defaults.t_sio2_1 }}"></td><td>m</td></tr>
    <tr><td>SiO₂ Thickness 2</td>    <td><input id="t_sio2_2" class="parameter-input" data-highlight="highlight-SiO2thick2" type="number" step="any" value="{{ defaults.t_sio2_2 }}"></td><td>m</td></tr>
    <tr><td>Titanium Thickness</td>  <td><input id="t_ti" class="parameter-input" data-highlight="highlight-Tithick" type="number" step="any" value="{{ defaults.t_ti }}"></td><td>m</td></tr>
    <tr><td>Alumina Thickness</td>   <td><input id="t_al2o3" class="parameter-input" data-highlight="highlight-Althick1" type="number" step="any" value="{{ defaults.t_al2o3 }}"></td><td>m</td></tr>
    <tr><td>Aluminum Thickness</td>  <td><input id="t_al" class="parameter-input" data-highlight="highlight-Althick2" type="number" step="any" value="{{ defaults.t_al }}"></td><td>m</td></tr>
    <tr><td>Iron Thickness</td>      <td><input id="t_fe" class="parameter-input" data-highlight="highlight-Fethick" type="number" step="any" value="{{ defaults.t_fe }}"></td><td>m</td></tr>
                </table>
            </div>
            <div class="image-container">
   <img src="{{ url_for('static',filename='images/dielecimage.png') }}" alt="Stack sketch">
                <div id="highlight-Sithick" class="highlight" style="top: 60%; left: 88%; width: 6%; height: 10%;"></div>
                <div id="highlight-SiO2thick" class="highlight" style="top: 55%; left: 88%; width: 6%; height: 6%;"></div>
                <div id="highlight-SiO2thick2" class="highlight" style="top: 45%; left: 88%; width: 6%; height: 6%;"></div>
                <div id="highlight-Tithick" class="highlight" style="top: 26%; left: 88%; width: 6%; height: 4%;"></div>
                <div id="highlight-Althick1" class="highlight" style="top: 50%; left: 88%; width: 6%; height: 6%;"></div>
                <div id="highlight-Althick2" class="highlight" style="top: 43%; left: 88%; width: 6%; height: 3%;"></div>
                <div id="highlight-Fethick" class="highlight" style="top: 39%; left: 88%; width: 6%; height: 3%;"></div>
            </div>
        </div>

 <!-- ══ Functionalization ══ -->
        <div class="section">
            <div class="table-container">
   <h3>Functionalization &amp; Analyte</h3>
                <table>
                    <tr><th>Parameter</th><th>Value</th><th>Unit</th></tr>
    <tr><td>Radius of Molecule</td>    <td><input id="mol_radius" type="number" step="any" value="{{ defaults.mol_radius }}"></td><td>m</td></tr>
    <tr><td>Length of Molecule</td>    <td><input id="mol_length" type="number" step="any" value="{{ defaults.mol_length }}"></td><td>m</td></tr>
    <tr><td>Gap Between Molecules</td> <td><input id="mol_gap"    type="number" step="any" value="{{ defaults.mol_gap }}"></td><td>m</td></tr>
    <tr><td>Dielectric of Molecule</td><td><input id="er_mol"     type="number" step="any" value="{{ defaults.er_mol }}"></td><td>–</td></tr>
                </table>
            </div>
            <div class="image-container">
   <img src="{{ url_for('static',filename='images/funcimage.png') }}" alt="DNA sketch">
            </div>
        </div>

 <!-- ══ Dielectric ══ -->
        <div class="section">
            <div class="table-container">
                <h3>Dielectric</h3>
                <table>
                    <tr><th>Parameter</th><th>Value</th><th>Unit</th></tr>
    <tr><td>Energy Density</td>         <td><input id="energy_density" type="number" step="any" value="{{ defaults.energy_density }}"></td><td>–</td></tr>
    <tr><td>Bulk Concentration (M)</td> <td><input id="conc_molar"     type="number" step="any" value="{{ defaults.conc_molar }}"></td><td>M</td></tr>
    <tr><td>Relative Permittivity</td>  <td><input id="er_solvent"     type="number" step="any" value="{{ defaults.er_solvent }}"></td><td>–</td></tr>
    <tr><td>Voltage</td>                <td><input id="voltage"        type="number" step="any" value="{{ defaults.voltage }}"></td><td>V</td></tr>
    <tr><td>Frequency Stage 1</td>      <td><input id="freq_stage1"    type="number" step="any" value="{{ defaults.freq_stage1 }}"></td><td>Hz</td></tr>
    <tr><td>Frequency Stage 2</td>      <td><input id="freq_stage2"    type="number" step="any" value="{{ defaults.freq_stage2 }}"></td><td>Hz</td></tr>
    <tr><td>Op-Amp Vo (V)</td>          <td><input id="op_amp_vo"      type="number" step="any" value=""></td><td>V</td></tr>
    <tr><td>Max Vout</td>               <td><input id="max_vout"       type="number" step="any" value="{{ defaults.max_vout }}"></td><td>V</td></tr>
    <tr><td>Series Resistance</td>      <td><input id="series_resistance" type="number" step="any" value="{{ defaults.series_resistance }}"></td><td>Ω</td></tr>
    <tr><td>Temperature</td>            <td><input id="temperature"    type="number" step="any" value="{{ defaults.temperature }}"></td><td>K</td></tr>
    <tr><td>Zeta Potential</td>         <td><input id="zeta_potential" type="number" step="any" value="{{ defaults.zeta_potential }}"></td><td>V</td></tr>
    <tr><td>Concentration Std. State</td><td><input id="concentration_standard" type="number" step="any" value="{{ defaults.concentration_standard }}"></td><td>–</td></tr>
    <tr><td>Change of Ion Species</td>   <td><input id="ion_species_change"     type="number" step="any" value="{{ defaults.ion_species_change }}"></td><td>–</td></tr>
                </table>
            </div>
            <div class="image-container">
   <img src="{{ url_for('static',filename='images/matstaximage.png') }}" alt="Dielectric sketch">
            </div>
        </div>

 <!-- ══ Circuit placeholders (unchanged) ══ -->
        <div class="section">
            <div class="table-container">
                <h3>Circuit</h3>
                <table>
                    <tr><th>Parameter</th><th>Value</th><th>Unit</th></tr>
    {% for fid,label,unit in [
        ('charging_current','Charging Current','A'),
        ('charging_voltage','Charging Voltage','V'),
        ('lens_resistivity','Lens Resistivity','Ω m'),
        ('lens_density','Lens Density','kg m⁻³'),
        ('lens_specific_heat','Lens Specific Heat','J kg⁻¹ K⁻¹'),
        ('lens_height','Lens Height','m'),
        ('lens_area','Lens Area','m²'),
        ('lens_r_in','Lens Inner Radius','m'),
        ('lens_r_out','Lens Outer Radius','m'),
        ('lithography_time','Lithography Time','s')] %}
      <tr><td>{{ label }}</td><td><input id="{{ fid }}" type="number" step="any" value="{{ defaults[fid] }}"></td><td>{{ unit }}</td></tr>
    {% endfor %}
                </table>
            </div>
            <div class="image-container">
   <img src="{{ url_for('static',filename='images/circuitimage.png') }}" alt="Circuit diagram">
            </div>
        </div>

 <!-- ══ Motor selector (UI only) ══ -->
 <div style="text-align:center">
                <h3>Motor Select + Liquid Dispense</h3>
  <label><input type="checkbox"> Motor 1</label>
  <label><input type="checkbox"> Motor 2</label>
  <label><input type="checkbox"> Motor 3</label>
  <div style="margin-top:6px">
   Dispensed Liquid: <input type="number" style="width:60px"> mL
                </div>
                <button class="run-simulation-btn">Run Simulation</button>
            </div>

 <!-- ══ Results ══ -->
 <div id="results">
  <h3 style="text-align:center">Simulation Results</h3>
  <table id="results-table">
   <thead>
    <tr><th>Quantity</th><th>Stage 1<br>(EDL + 1 H)</th><th>Stage 2<br>(EDL + 2 H)</th></tr>
   </thead>
   <tbody>
    <tr><td>Capacitance (F)</td>  <td id="c1"></td><td id="c2"></td></tr>
    <tr><td>Impedance |Z| (Ω)</td><td id="z1"></td><td id="z2"></td></tr>
    <tr><td>Current (A)</td>      <td id="i1"></td><td id="i2"></td></tr>
    <tr><td>Op-Amp Vo (V)</td>    <td id="vo1"></td><td id="vo2"></td></tr>
    <tr><td>ΔI = I₁ − I₂ (A)</td><td colspan="2" id="di"></td></tr>
    <tr><td>ΔZ = Z₁ − Z₂ (Ω)</td><td colspan="2" id="dz"></td></tr>
   </tbody>
  </table>
        </div>
    </div>

<!-- ══ JS: highlight boxes ══ -->
    <script>
document.querySelectorAll('.parameter-input').forEach(input => {
            input.addEventListener('focus', () => {
                const highlightId = input.dataset.highlight;
                const highlightElement = document.getElementById(highlightId);
                if (highlightElement) {
                    highlightElement.style.display = 'block';
                }
            });

            input.addEventListener('blur', () => {
                const highlightId = input.dataset.highlight;
                const highlightElement = document.getElementById(highlightId);
                if (highlightElement) {
                    highlightElement.style.display = 'none';
                }
            });
        });
    </script>

<!-- ══ JS: run simulation & fill results ══ -->
<script>
const fmt = x => Number(x).toExponential(3);

document.querySelector('.run-simulation-btn').addEventListener('click', async ()=>{
  const payload={};
  document.querySelectorAll('input[id]').forEach(el=>payload[el.id]=el.value);
  const res = await fetch('/simulate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
  if(!res.ok){alert('Server error');return;}
  const d = await res.json();

  document.getElementById('c1').textContent  = fmt(d.stage1.C);
  document.getElementById('c2').textContent  = fmt(d.stage2.C);
  document.getElementById('z1').textContent  = fmt(d.stage1.Z);
  document.getElementById('z2').textContent  = fmt(d.stage2.Z);
  document.getElementById('i1').textContent  = fmt(d.stage1.I);
  document.getElementById('i2').textContent  = fmt(d.stage2.I);
  document.getElementById('vo1').textContent = fmt(d.stage1.Vo);
  document.getElementById('vo2').textContent = fmt(d.stage2.Vo);
  document.getElementById('di').textContent  = fmt(d.Delta_I);
  document.getElementById('dz').textContent  = fmt(d.Delta_Z);

  document.getElementById('results').style.display='block';
});
</script>
</body>
</html>